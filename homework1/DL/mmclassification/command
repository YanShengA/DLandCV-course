PORT=29505 CUDA_VISIBLE_DEVICES=4,5 nohup ./tools/dist_train.sh \
/media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_1.py 2 \
--work-dir work_dirs/F_1 \
> logs/F_1.log 2>&1 &



pushtask_mm() {
    # 1. è·å–é…ç½®æ–‡ä»¶è·¯å¾„
    local config_path=$1
    
    # æ£€æŸ¥æ˜¯å¦æä¾›äº†å‚æ•°
    if [ -z "$config_path" ]; then
        echo "é”™è¯¯: è¯·æä¾›é…ç½®æ–‡ä»¶è·¯å¾„"
        echo "ç”¨æ³•: pushtask_mm <config_path>"
        return 1
    fi

    # 2. æå–ä»»åŠ¡åç§° (ä¾‹å¦‚ä» .../resnet18.py æå–å‡º resnet18)
    local task_name=$(basename "$config_path" .py)
    
    # 3. ç”Ÿæˆéšæœºç«¯å£ (é˜²æ­¢å¹¶è¡Œä»»åŠ¡å†²çª)
    local port=$((29500 + RANDOM % 200))
    
    # 4. è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³ (ç”¨äºæ—¥å¿—åŒºåˆ†)
    local timestamp=$(date +%Y%m%E_%H%M%S)

    # ç¡®ä¿æ—¥å¿—å’Œå·¥ä½œç›®å½•å­˜åœ¨
    mkdir -p logs
    mkdir -p work_dirs/${task_name}

    # 5. æ„é€ æŒ‡ä»¤
    # æ³¨æ„ï¼š
    # - ç§»é™¤äº† CUDA_VISIBLE_DEVICES (è°ƒåº¦å™¨è´Ÿè´£)
    # - ç§»é™¤äº† nohup å’Œ & (è°ƒåº¦å™¨è´Ÿè´£)
    # - ä¿ç•™äº† '2' (æ˜¾å¡æ•°é‡)ï¼Œè¿™å¿…é¡»ä¸è°ƒåº¦å™¨è„šæœ¬é‡Œçš„ GPUS_PER_TASK=2 ä¸€è‡´
    # - è‡ªåŠ¨è®¾ç½® --work-dir
    # - è‡ªåŠ¨é‡å®šå‘æ—¥å¿—
    local cmd="PORT=$port ./tools/dist_train.sh \
    $config_path 2 \
    --work-dir work_dirs/${task_name} \
    > logs/${task_name}.log 2>&1"

    # 6. å†™å…¥ä»»åŠ¡é˜Ÿåˆ—æ–‡ä»¶
    # æ–‡ä»¶åæ ¼å¼ï¼šæ—¶é—´æˆ³_ä»»åŠ¡å.sh
    local queue_file="./task_queue/$(date +%s)_${task_name}.sh"
    
    echo "$cmd" > "$queue_file"
    
    echo "âœ… ä»»åŠ¡å·²åŠ å…¥é˜Ÿåˆ—: ${task_name}"
    echo "   ğŸ“„ æ—¥å¿—è·¯å¾„: logs/${task_name}.log"
    echo "   ğŸ“‚ Work Dir: work_dirs/${task_name}"
    echo "   ğŸ”Œ ä½¿ç”¨ç«¯å£: $port"
}


pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_1.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_2.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_3.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_4.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_5.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_6.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_7.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_8.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_9.py
pushtask_mm /media/HDD0/wzl/mmcls/DLandCV-course/homework1/DL/mmclassification/configs/Amytest/F_10.py



tensorboard --logdir=./work_dirs --port=6007

æœ¬åœ°ç”µè„‘
ssh -L 16007:localhost:6007 fuping@10.21.12.40
Ek&JkfG@roQfC
ç„¶åæ‰“å¼€http://localhost:16007
